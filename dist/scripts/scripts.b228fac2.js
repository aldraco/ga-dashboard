"use strict";angular.module("EventsDashboard",["ngAnimate","ngResource","ui.router","ui.bootstrap","ngTouch","ngLodash","chart.js"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("dashboard",{url:"/dashboard","abstract":!0,templateUrl:"views/dashboard.html",controller:"DashboardController"}).state("dashboard.summary",{url:"",controller:"DashboardController",templateUrl:"views/templates/dashboardSummary.html"}).state("dashboard.userStats",{url:"/user-statistics",controller:"DashboardController",templateUrl:"views/templates/dashboardStats.html"}).state("about",{url:"/about",controller:"AboutCtrl",templateUrl:"views/about.html"}),b.otherwise("/")}]),angular.module("EventsDashboard").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]).controller("NavigationController",["$scope",function(a){a.activeTab="home",a.changeTab=function(a){$state.go(a)}}]),angular.module("EventsDashboard").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("EventsDashboard").controller("DashboardController",["$scope","$rootScope","EventsProvider","lodash",function(a,b,c,d){function e(b){var c=d.countBy(b,"country");a.byCountry={labels:Object.keys(c),data:d.values(c)}}function f(a,b){return d.filter(a,function(a){return a.timestamp>=b.startDate/1e3&&a.timestamp<=b.endDate/1e3})}function g(b){for(var c=0,d=[],e=0,f=0;f<b.length;f++){if(f===b.length-1){c++,d.push(c);var g=[];return g.push(d),a.byWeek={data:g,labels:h(d.length)}}c++,new Date(1e3*b[f].timestamp).getDay()<new Date(1e3*b[f+1].timestamp).getDay()&&e++,7===e&&(d.push(c),e=0,c=0)}}function h(a){for(var b=[],c=0;a>c;c++)b.push("Week "+c);return b}a.byCountry,a.filteredEvents,a.allEvents,a.series=["Data by Week"],c.then(function(b){a.allEvents=b,a.filteredEvents=d.sortBy(b,"timestamp"),e(b),g(b),a.$watchGroup(["startDate","endDate"],function(b,c,d){var e=f(a.allEvents,{startDate:b[0],endDate:b[1]});a.filteredEvents=e}),a.$watch("filteredEvents",function(b,c){e(b),g(a.filteredEvents)})})}]),angular.module("EventsDashboard").controller("DatepickerCtrl",["$scope","$rootScope",function(a,b){a.today=function(){b.endDate=new Date,b.startDate=new Date,a.maxDate=new Date},a.today(),a.clear=function(){b.startDate=null},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateOptions={formatYear:"yy",startingDay:1},a.format="dd-MMMM-yyyy"}]),angular.module("EventsDashboard").factory("EventsFactory",["$resource",function(a){return a("http://micky.zyring.com/fullEvents")}]),angular.module("EventsDashboard").factory("EventsProvider",["$q","EventsFactory",function(a,b){var c=a.defer();return b.query({},function(a){c.resolve(a)},function(a){return 404===a.status?"Not able to find events.":void c.reject("Unable to fetch data from server.")}),c.promise}]);